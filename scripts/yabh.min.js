//=============================================================================
// yabh.src.js
//
// Código completo do jogo todo encapsulado numa função e compactado. Agora tá
// perfeito pra usar.
//=============================================================================
"use strict";!function(){function t(t,i,n){if(!i||"object"!=typeof i)throw new Error("Protótipo inválido para a classe");var o=function(){this.initialize.apply(this,arguments)};if(t){e(t,"function","_super"),o.prototype=Object.create(t.prototype),o.prototype.__super__=t.prototype,o.prototype.constructor=o;for(var r in i)o.prototype[r]=i[r]}else o.prototype=i;if(n){if("object"!=typeof n)throw new Error("Propriedades inválidas");Object.defineProperties(o.prototype,n)}return o}function e(t,e,i){if(typeof t!=e)throw new Error("Tipo inválido para `"+i+"'")}function i(t,e,i){if("object"!=typeof t||!(t instanceof e))throw new Error("Tipo inválido para `"+i+"'")}function n(){this.dispose();for(var t=0;54>=t;t++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(4,2*Math.PI/54*t)]),this);a.playSe("audio/enemyDeath.m4a",.2,.5)}function o(){h.clear(),s.update(),h.render(),requestAnimationFrame(o)}Number.prototype.between=function(t,i){e(t,"number","a"),e(i,"number","b");var n=t>i?t:i,o=i>t?t:i;return this>=o&&n>=this},Object.prototype.clone=function(){var t=Object.create(this);if(this instanceof Array)for(var e=0;e<this.length;e++)this[e]&&"object"==typeof this[e]?t[e]=this[e].clone():t[e]=this[e];else for(var i in this)this.hasOwnProperty(i)&&(this[i]&&"object"==typeof this[i]?t[i]=this[i].clone():t[i]=this[i]);return t},Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return!0;return!1},Array.prototype.remove=function(t){this.splice(this.indexOf(t),1)};var r={_codes:{shift:16,space:32,left:37,up:38,right:39,down:40,z:90},_keysDown:[],reset:function(){this._keysDown=[]},dir8:function(){var t=this._keysDown.contains(this._codes.left),e=this._keysDown.contains(this._codes.up),i=this._keysDown.contains(this._codes.right),n=this._keysDown.contains(this._codes.down);return t?n?1:e?7:4:i?n?3:e?9:6:e?8:n?2:0},shiftPressed:function(){return this._keysDown.contains(this._codes.shift)},actionPressed:function(){return this._keysDown.contains(this._codes.z)||this._keysDown.contains(this._codes.space)}};document.addEventListener("keydown",function(t){r._keysDown.contains(t.keyCode)||r._keysDown.push(t.keyCode)}),document.addEventListener("keyup",function(t){r._keysDown.remove(t.keyCode)}),window.addEventListener("blur",function(){r._keysDown=[]});var s={_player:null,_objects:[],_stages:[],_movements:{},_actionPatterns:{},_stageID:0,_pause:!1,start:function(){this.createPlayer(),this.setupStage()},update:function(){for(var t=0,e=!1;t<this._objects.length&&!e;)e=this._objects[t]instanceof d,e=e||this._objects[t]instanceof m&&this._objects[t].shooter instanceof d,t++;return e||(this.currentStage.terminate(),this.nextStage(),this.setupStage()),r._keysDown.contains(17)?this.restart():(r._keysDown.contains(27)?this._pause=!0:r.actionPressed()&&(this._pause=!1),void(this._pause||this.forEachObject(function(t){t.update()})))},restart:function(){this.currentStage.terminate(),this.clear(),this.start()},clear:function(){this.forEachObject(function(t){t.dispose()}),this._player&&this._player.dispose(),this._player=null,h.fullClear(),this._objects=[]},setupStage:function(){this.currentStage?(h.backgroundColor=this.currentStage.backgroundColor,a.playBgm.apply(a,this.currentStage.bgm),this.currentStage.initialize()):this.nextStage()},nextStage:function(){this._stageID++,this._checkFinished()},_checkFinished:function(){this._stageID>=this._stages.length&&(console.log("Você zerou o jogo!"),window.location=window.location)},createPlayer:function(){return this._player=new g(h.width/2,h.height-32),this.add(this._player),this._player},createMovement:function(t,n,o){return e(t,"string","name"),i(n,Array,"velocities"),this._movements[t]||(this._movements[t]=new f(n),o&&(this._movements[t].onUpdate=o)),this._movements[t]},createActionPattern:function(t,i){return e(t,"string","name"),this._actionPatterns[t]=new b(i),this._actionPatterns[t]},createStage:function(t){e(t,"object","obj"),this._stages.push(t)},createEnemy:function(t,e,i,n,o){var r=new d(t,e,i,n,o);return this.add(r),r},createEnemies:function(){for(var t=[],e=0;e<arguments.length;e++)i(arguments[e],Array,"arguments["+e+"]"),t.push(this.createEnemy.apply(this,arguments[e]));return t},createProjectile:function(t,e,i,n){var o=new m(t,e,i,n);return this.add(o),n instanceof g&&a.playSe("audio/playerShot.m4a",.1,2),o},movement:function(t){return e(t,"string","name"),this._movements[t]},actionPattern:function(t){return e(t,"string","name"),this._actionPatterns[t]},add:function(t){if(i(t,l,"obj"),!this._objects.contains(t)){for(var e=0,n=this._objects.length-1,o=0;n>=e;){if(o=Math.floor((e+n)/2),this._objects[o]==t)return;if(this._objects[o].color==t.color)break;this._objects[o].color>t.color?n=o-1:this._objects[o].color<t.color&&(e=o+1)}this._objects.splice(o,0,t)}},remove:function(t){i(t,l,"obj"),this._objects.remove(t)},forEachObject:function(t){for(var e=0;e<this._objects.length;e++)t.call(null,this._objects[e])}};Object.defineProperties(s,{currentStage:{get:function(){return this._stages[this._stageID]}},player:{get:function(){return this._player}}});var h={initialize:function(t){(void 0==t||null==t)&&(t=!0),e(t,"boolean","webgl"),this._useWebGL=t,this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this.width=640,this.height=480,this._useWebGL?(this._initWebGL(),this._initShaders(),this._initVerticesBuffer()):this._initCanvas(),document.body.appendChild(this._canvas)},_initCanvas:function(){this._canvasContext=this._canvas.getContext("2d")},_initWebGL:function(){try{if(window.gl=this._canvas.getContext("webgl")||this._canvas.getContext("experimental-webgl"),!window.gl)throw new Error;window.gl.viewport(0,0,this._canvas.width,this._canvas.height)}catch(t){this._useWebGL=!1,this._initCanvas()}},_loadShader:function(t){var e=document.getElementById(t);if(e)return e.innerText;throw new Error("Falha ao carregar shader `"+t+"'")},_initShaders:function(){function t(t){if(gl.compileShader(t),!gl.getShaderParameter(t,gl.COMPILE_STATUS))throw new Error("Erro de compilação no shader: "+gl.getShaderInfoLog(t))}var e=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(e,this._loadShader("color-fragshader")),t(e);var i=gl.createShader(gl.VERTEX_SHADER);if(gl.shaderSource(i,this._loadShader("pixel-vxshader")),t(i),this._shaderProgram=gl.createProgram(),gl.attachShader(this._shaderProgram,i),gl.attachShader(this._shaderProgram,e),gl.linkProgram(this._shaderProgram),!gl.getProgramParameter(this._shaderProgram,gl.LINK_STATUS))throw new Error("Não foi possível inicializar os shaders");gl.useProgram(this._shaderProgram),this._vertPosAttr=gl.getAttribLocation(this._shaderProgram,"vertexPosition"),gl.enableVertexAttribArray(this._vertPosAttr);var n=gl.getUniformLocation(this._shaderProgram,"screenSize");gl.uniform2f(n,this.width,this.height)},_initVerticesBuffer:function(){this._vBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer);var t=[1,1,-1,1,1,-1,-1,-1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(t),gl.STATIC_DRAW)},fullClear:function(){this._useWebGL||this._canvasContext.clearRect(0,0,this.width,this.height)},clear:function(){this._useWebGL?gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT):s.forEachObject(function(t){this._canvasContext.clearRect(t.hitbox.left+.5|0,t.hitbox.top+.5|0,t.hitbox.width+.5|0,t.hitbox.height+.5|0)}.bind(this))},_renderWebGL:function(){gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer),gl.vertexAttribPointer(this._vertPosAttr,2,gl.FLOAT,!1,0,0);var t=gl.getUniformLocation(this._shaderProgram,"size"),e=gl.getUniformLocation(this._shaderProgram,"translate"),i=gl.getUniformLocation(this._shaderProgram,"color"),n=-1,o=0,r=0;s.forEachObject(function(s){(s._hitbox.width!=o||s._hitbox.height!=r)&&(gl.uniform2f(t,s._hitbox.width,s._hitbox.height),o=s._hitbox.width,r=s._hitbox.height),n!=s.color&&(gl.uniform3f(i,(s.color>>16&255)/255,(s.color>>8&255)/255,(255&s.color)/255),n=s.color),gl.uniform2f(e,s._hitbox.x,s._hitbox.y),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}.bind(this))},_renderCanvas:function(){var t=-1;s.forEachObject(function(e){if(t!=e.color){var i=e.color.toString(16);this._canvasContext.fillStyle="#"+"000000".substring(0,6-i.length)+i,t=i}this._canvasContext.fillRect(e.hitbox.left+.5|0,e.hitbox.top+.5|0,e.hitbox.width+.5|0,e.hitbox.height+.5|0)}.bind(this))},render:function(){this._useWebGL?this._renderWebGL():this._renderCanvas()}};Object.defineProperties(h,{width:{get:function(){return this._canvas.width},set:function(t){e(t,"number","value"),this._canvas.width=t}},height:{get:function(){return this._canvas.height},set:function(t){e(t,"number","value"),this._canvas.height=t}},backgroundColor:{get:function(){return this._canvas.style.backgroundColor},set:function(t){e(t,"number","value");var i=t.toString(16);this._canvas.style.backgroundColor="#"+"000000".substring(0,6-i.length)+i}}});var a={initialize:function(){this._bgm=new Audio,this._mute=!1,this._currentBgm=""},playBgm:function(t,i,n){this._mute||(e(t,"string","filename"),i&&(e(i,"number","volume"),this._bgm.volume=i),n&&(e(n,"number","pitch"),this._bgm.playbackRate=n),this._currentBgm!=t&&(this._bgm.pause(),this._currentBgm=t,this._bgm.src=t,this._bgm.addEventListener("canplay",function(){this._bgm.play(),this._bgm.addEventListener("ended",function(){this._bgm.play()}.bind(this))}.bind(this))))},stopBgm:function(){this._bgm.pause()},playSe:function(t,i,n){if(!this._mute){e(t,"string","filename");var o=new Audio(t);return i&&(e(i,"number","volume"),o.volume=i),n&&(e(n,"number","pitch"),o.playbackRate=n),o.play(),o}}},c=t(null,{initialize:function(t,i,n,o){if(e(t,"number","x"),e(t,"number","y"),e(t,"number","w"),e(t,"number","h"),0>=n)throw new Error("A largura da hitbox deve ser maior que zero");if(0>=o)throw new Error("A altura da hitbox deve ser maior que zero");this._x=t,this._y=i,this._w=n,this._h=o},collidesWith:function(t){i(t,c,"other");var e=0;return this.right.between(t.left,t.right)?e++:this.left.between(t.left,t.right)&&e++,this.bottom.between(t.top,t.bottom)?e++:this.top.between(t.top,t.bottom)&&e++,e>1}},{x:{get:function(){return this._x},set:function(t){e(t,"number","value"),this._x=t}},y:{get:function(){return this._y},set:function(t){e(t,"number","value"),this._y=t}},width:{get:function(){return this._w},set:function(t){if(e(t,"number","value"),0>t)throw new Error("A largura deve ser maior que zero");this._w=t,this.x=this._x}},height:{get:function(){return this._h},set:function(t){if(e(t,"number","value"),0>t)throw new Error("A altura deve ser maior que zero");this._h=t,this.y=this._y}},left:{get:function(){return this._x-this._w/2},set:function(t){this.x=t+this._w/2}},right:{get:function(){return this._x+this._w/2},set:function(t){this.x=t-this._w/2}},top:{get:function(){return this._y-this._h/2},set:function(t){this.y=t+this._h/2}},bottom:{get:function(){return this._y+this._h/2},set:function(t){this.y=t-this._h/2}}}),l=t(null,{initialize:function(t,e,n){this._hitbox=new c(t,e,1,1),"string"==typeof n&&(n=s.movement(n)),i(n,f,"movement"),this._movement=n.bind(this),this._color=null},update:function(){this._movement.update(),this._movement.apply(),this._checkDispose()},_checkDispose:function(){this.hitbox.x.between(0,h.width-1)&&this.hitbox.y.between(0,h.height-1)||this.dispose()},dispose:function(){s.remove(this)}},{hitbox:{get:function(){return this._hitbox},set:function(t){i(t,c,"value"),this._hitbox=t}},color:{get:function(){return this._color?this._color:this instanceof g?s.currentStage.playerColor:this instanceof d?s.currentStage.enemyColor:this instanceof m&&this._shooter instanceof g?s.currentStage.playerProjectileColor:this instanceof m&&this._shooter instanceof d?s.currentStage.enemyProjectileColor:void 0},set:function(t){e(t,"number","value"),this._color=t}},movement:{get:function(){return this._movement},set:function(t){i(t,f,"value"),this._movement=t.bind(this)}}}),_=t(null,{initialize:function(t,i){e(t,"number","module"),e(i,"number","module"),this._x=t*Math.cos(i),this._y=t*Math.sin(i)},apply:function(t){i(t,l,"object"),t.hitbox.x+=this._x,t.hitbox.y+=this._y}},{x:{get:function(){return this._x},set:function(t){e(t,"number","value"),this._x=t}},y:{get:function(){return this._y},set:function(t){e(t,"number","value"),this._y=t}},module:{get:function(){return this._x/Math.cos(this.angle)},set:function(t){e(t,"number","value"),this.initialize(t,this.angle)}},angle:{get:function(){return Math.atan2(this._y,this._x)||0},set:function(t){e(t,"number","value"),this.initialize(this.module,t)}}}),u=t(null,{initialize:function(){throw new Error("`Bindable' é uma classe abstrata")},_initialize:function(){this._object=null},bind:function(t){var e=this.clone();return e._object=t,e}}),f=t(u,{initialize:function(t){this.__super__._initialize.call(this),t&&(i(t,Array),this._velocities=t),this._onUpdateSrc=null,this._onUpdate=null},update:function(){if(!this._object)throw new Error("Não é possível atualizar o movimento antes de ligá-lo a um objeto");this._onUpdate&&this._onUpdate()},bind:function(t){var e=this.__super__.bind.call(this,t);return this._onUpdateSrc&&(e.onUpdate=this._onUpdateSrc),e},apply:function(){for(var t=0;t<this._velocities.length;t++)this._velocities[t].apply(this._object)}},{onUpdate:{get:function(){return this._onUpdate},set:function(t){e(t,"function","value"),this._onUpdateSrc=t,this._onUpdate=t.bind(this)}}}),m=t(l,{initialize:function(t,e,n,o){i(o,l,"shooter"),this._shooter=o,this.__super__.initialize.call(this,t,e,n),this._hitbox.width=this._hitbox.height=6},update:function(){this.__super__.update.call(this),s.forEachObject(function(t){this._shooter instanceof d?t instanceof g&&this._hitbox.collidesWith(t.hitbox)&&(this.dispose(),s.restart()):t instanceof d&&this._hitbox.collidesWith(t.hitbox)&&(t.applyDamage(),this.dispose())}.bind(this))}},{shooter:{get:function(){return this._shooter}}}),d=t(l,{initialize:function(t,n,o,r,h){this.__super__.initialize.call(this,t,n,o),this._hitbox.width=this._hitbox.height=10,e(r,"number","health"),e(h,"string","actions"),h=s.actionPattern(h),i(h,b,"actions"),this._maxHealth=r,this._health=r,this._actions=h.bind(this),this._actions.on("initialize")()},applyDamage:function(){this._health--,this._checkDeath()},_checkDeath:function(){this._health<=0&&this._actions.on("death")()},update:function(){this.__super__.update.call(this),this._actions.on("update")()}},{health:{get:function(){return this._health}},maxHealth:{get:function(){return this._maxHealth}}}),b=t(u,{initialize:function(t){this.__super__._initialize.call(this),e(t,"object","events"),this._events=t},bind:function(t){var e=this.__super__.bind.call(this,t);for(var i in e._events)e._events[i]=e._events[i].bind(t);return e},on:function(t){return this._events[t]}}),g=t(l,{initialize:function(t,e){this.__super__.initialize.call(this,t,e,"player"),this._fireTimer=0,this._hitbox.width=this._hitbox.height=8},update:function(){this.__super__.update.call(this),this._hitbox.left<0&&(this._hitbox.left=0),this._hitbox.right>h.width&&(this._hitbox.right=h.width),this._hitbox.top<0&&(this._hitbox.top=0),this._hitbox.bottom>h.height&&(this._hitbox.bottom=h.height),r.actionPressed()?(this._fireTimer%=6,0==this._fireTimer++&&s.createProjectile(this.hitbox.x,this.hitbox.y,"straightUp",this)):this._fireTimer>0&&(this._fireTimer=0)},_checkDispose:function(){}});s.createMovement("static",[]),s.createMovement("straightUp",[new _(8,-Math.PI/2)]),s.createMovement("straightLeft",[new _(4,Math.PI)]),s.createMovement("straightRight",[new _(4,0)]),s.createMovement("rightLeft",[new _(4,0)],function(){this._timer||(this._timer=0),this._timer++,this._timer%=90,0==this._timer&&(this._velocities[0].angle+=Math.PI)}),s.createMovement("leftRight",[new _(4,Math.PI)],function(){this._timer||(this._timer=0),this._timer++,this._timer%=90,0==this._timer&&(this._velocities[0].angle+=Math.PI)}),s.createMovement("circleRight",[new _(2,0)],function(){this._velocities[0].angle+=.1}),s.createMovement("circleLeft",[new _(2,-Math.PI)],function(){this._velocities[0].angle-=.1}),s.createMovement("spiralUp",[new _(4,0),new _(4,-Math.PI/2)],function(){this._velocities[0].angle+=.1}),s.createMovement("spiralDown",[new _(4,Math.PI),new _(4,Math.PI/2)],function(){this._velocities[0].angle-=.1}),s.createMovement("chasePlayer",[new _(4,0)],function(){var t=this._object.hitbox.y-s.player.hitbox.y,e=this._object.hitbox.x-s.player.hitbox.x,i=Math.atan2(t,e);this._velocities[0].angle=i+Math.PI}),s.createMovement("targetPlayer",[new _(4,0)],function(){if(!this._targeted){this._targeted=!0;var t=this._object.hitbox.y-s.player.hitbox.y,e=this._object.hitbox.x-s.player.hitbox.x,i=Math.atan2(t,e);this._velocities[0].angle=i+Math.PI}}),s.createMovement("player",[new _(0,0)],function(){this._velocities[0].module=r.shiftPressed()?1.25:3;var t=[0,3*Math.PI/4,Math.PI/2,Math.PI/4,Math.PI,0,2*Math.PI,5*Math.PI/4,3*Math.PI/2,7*Math.PI/4][r.dir8()];0==t&&(this._velocities[0].module=0),this._velocities[0].angle=t}),s.createActionPattern("still",{initialize:function(){},update:function(){},death:n}),s.createActionPattern("straightUp",{initialize:function(){this._fireTimer=0},update:function(){this._fireTimer%5==0&&s.createProjectile(this._hitbox.x,this._hitbox.y,"straightUp",this),this._fireTimer++},death:function(){}}),s.createActionPattern("shootPlayer",{initialize:function(){this._timer=0,this._timeouts=[]},update:function(){if(this._timer++,this._timer%60==0&&this._hitbox.y+64<s.player.hitbox.y)for(var t=0;1>t;t++)this._timeouts.push(setTimeout(function(){s.createProjectile(this._hitbox.x,this._hitbox.y,"targetPlayer",this)}.bind(this),200*t+1))},death:function(){for(var t=0;t<this._timeouts.length;t++)clearTimeout(this._timeouts[t]);this.dispose()}}),s.createActionPattern("circle",{initialize:function(){this._fireTimer=0},update:function(){var t=48;if(this._fireTimer%72==0){for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,2*Math.PI/t*e)]),this);a.playSe("audio/enemyShot01.m4a",.05,.5)}this._fireTimer++},death:n}),s.createActionPattern("circle1",{initialize:function(){this._fireTimer=0},update:function(){var t=24;if(this._fireTimer%72==0){for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,2*Math.PI/t*e)]),this);a.playSe("audio/enemyShot01.m4a",.05,.5)}this._fireTimer++},death:n}),s.createActionPattern("spiral1",{initialize:function(){this._fireTimer=0},update:function(){this._fireTimer%5==0&&s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,2*-Math.PI/240*this._fireTimer)]),this),this._fireTimer++},death:n}),s.createActionPattern("spiral2",{initialize:function(){this._fireTimer=0},update:function(){this._fireTimer%5==0&&s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,2*Math.PI/240*this._fireTimer)]),this),this._fireTimer++},death:n}),s.createActionPattern("arc1",{initialize:function(){this._timer=0},update:function(){var t=10;if(this._timer++%120==0)for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(1.5-e/t/2,Math.PI/4+Math.PI/4/t*e)]),this);if(this._timer%150==0)for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(1.5-e/t/2,Math.PI/4+Math.PI/4/t*e)]),this)},death:n}),s.createActionPattern("arc2",{initialize:function(){this._timer=0},update:function(){var t=10;if(this._timer++%120==0)for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(1+e/t/2,Math.PI/2+Math.PI/4/t*e)]),this);if(this._timer%150==0)for(var e=0;t>=e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(1+e/t/2,Math.PI/2+Math.PI/4/t*e)]),this)},death:n}),s.createActionPattern("boss1",{initialize:function(){this._fireTimer=0,this._deathCount=0,this._positioned=!0},update:function(){var t=this._maxHealth-this._health,e=t/this._maxHealth,i=function(t){for(var e=Math.PI/120*t,i=0;2>i;i++)for(var n=t*i*Math.PI/16,o=[e*this._fireTimer+n,Math.PI/2+e*this._fireTimer+n,Math.PI+e*this._fireTimer+n,1.5*Math.PI+e*this._fireTimer+n],r=0;r<o.length;r++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,o[r])]),this)}.bind(this),n=function(){for(var t=42,e=0;t>e;e++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,2*Math.PI/t*e)]),this);a.playSe("audio/enemyShot01.m4a",.05,.5)}.bind(this);if(this._positioned)switch(this._deathCount){case 1:case 2:if(this._fireTimer%Math.floor(9-2*e)==0&&i(-1),1==this._deathCount){this._fireTimer%120==0&&n();break}case 0:this._fireTimer%Math.floor(9-2*e)==0&&i(1),this._fireTimer%120==0&&n();break;case 3:if(this._fireTimer%2==0)for(var o=0;2>o;o++)s.createProjectile(this._hitbox.x,this._hitbox.y,new f([new _(2,Math.random()*Math.PI*2)]),this)}var r=255,h=255&Math.floor(255-255*e);this._color=(r<<16)+(h<<8)+h,this._fireTimer++},death:function(){switch(this._deathCount++,this._deathCount){case 1:this._positioned=!1,this.movement=new f([new _(4,0)]),this._onPosInterval=setInterval(function(){this.hitbox.x>=2*h.width/3&&(this.movement=s.movement("static"),clearInterval(this._onPosInterval),this._positioned=!0)}.bind(this),10);break;case 2:this.movement=new f([new _(.3,Math.PI)]),this.movement.onUpdate=function(){0==this._velocities[0].angle&&this._object.hitbox.x>=2*h.width/3?this._velocities[0].angle=Math.PI:this._velocities[0].angle==Math.PI&&this._object.hitbox.x<=h.width/3&&(this._velocities[0].angle=0)};break;case 3:this.movement=s.movement("circleRight")}4==this._deathCount?this.dispose():this._health=this._maxHealth}}),s.createStage({backgroundColor:0,playerColor:65280,enemyColor:16711680,playerProjectileColor:65535,enemyProjectileColor:16776960,bgm:["audio/badapple.mp3"],initialize:function(){var t=s.createEnemy(h.width/2,128,"static",40,"circle1");this._i1=setInterval(function(){if(!(t.health<=0)){s.createEnemy(Math.random()*h.width,0,new f([new _(3,Math.random()*Math.PI/4+Math.PI/4)]),1,"shootPlayer")}},1e3)},terminate:function(){clearInterval(this._i1)}}),s.createStage({backgroundColor:0,playerColor:65280,enemyColor:16711680,playerProjectileColor:65535,enemyProjectileColor:16776960,bgm:["audio/badapple.mp3"],initialize:function(){this._enemies=s.createEnemies([h.width/6,32,"static",15,"arc1"],[5*h.width/6,32,"static",15,"arc2"]),this._i1=setInterval(function(){this._enemies.some(function(t){return t.health>0})&&s.createEnemy(h.width-1,64*Math.random()+32,"straightLeft",1,"spiral2")}.bind(this),3e3),this._i2=setInterval(function(){this._enemies.some(function(t){return t.health>0})&&s.createEnemy(1,64*Math.random()+32,"straightRight",1,"spiral2")}.bind(this),6e3)},terminate:function(){clearInterval(this._i1),clearInterval(this._i2)}}),s.createStage({backgroundColor:0,playerColor:65280,enemyColor:16711680,playerProjectileColor:65535,enemyProjectileColor:16776960,bgm:["audio/badapple.mp3"],initialize:function(){var t=s.createEnemy(h.width/3,96,"static",60,"boss1");t.hitbox.width=t.hitbox.height=16,t.color=16777215},terminate:function(){}}),s.createStage({backgroundColor:16777215,playerColor:43775,enemyColor:0,playerProjectileColor:65280,enemyProjectileColor:16711680,bgm:["audio/tetris.mp3"],initialize:function(){this._enemies=s.createEnemies([h.width/3,96,"static",5,"circle1"],[2*h.width/3,96,"static",5,"circle1"],[h.width/2,192,"static",5,"circle1"]),this._i1=setInterval(function(){this._enemies.some(function(t){return t.health>0})&&s.createEnemy(0,32,"circleRight",10,"arc1")}.bind(this),2e3),this._i2=setInterval(function(){this._enemies.some(function(t){return t.health>0})&&s.createEnemy(h.width-1,32,"circleLeft",10,"arc2")}.bind(this),3e3)},terminate:function(){clearInterval(this._i1),clearInterval(this._i2)}}),s.createStage({backgroundColor:16777215,playerColor:43775,enemyColor:0,playerProjectileColor:65280,enemyProjectileColor:16711680,bgm:["audio/tetris.mp3"],initialize:function(){this._touts=[],this._e=s.createEnemy(h.width/5,32,"rightLeft",10,"spiral1"),this._i1=setInterval(function(){this._e.health<=0||(s.createEnemy(64,h.height-64,"spiralUp",5,"circle1"),this._touts.push(setTimeout(function(){s.createEnemy(h.width-64,64,"spiralDown",5,"circle1")},1e3)))}.bind(this),3e3)},terminate:function(){clearInterval(this._i1);for(var t=0;t<this._touts.length;t++)clearTimeout(this._touts[t])}}),h.initialize(),a.initialize(),s.start(),o()}();